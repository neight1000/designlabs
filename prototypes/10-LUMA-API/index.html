<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luma AI 3D Video Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .mode-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .toggle-btn {
            padding: 12px 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1rem;
        }

        .prompt-input {
            min-height: 100px;
            resize: vertical;
        }

        .generate-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(238, 90, 36, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .preset-btn {
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        .result {
            display: none;
            text-align: center;
        }

        .result.active {
            display: block;
        }

        .result video {
            width: 100%;
            max-width: 500px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .error {
            display: none;
            background: rgba(255, 0, 0, 0.2);
            color: #ff6b6b;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
        }

        .error.active {
            display: block;
        }

        .info {
            background: rgba(23, 162, 184, 0.2);
            border: 1px solid rgba(23, 162, 184, 0.4);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            color: #17a2b8;
        }

        .placeholder {
            text-align: center;
            color: rgba(255,255,255,0.7);
            margin-top: 50px;
        }

        .placeholder-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .preset-grid {
                grid-template-columns: 1fr;
            }

            .mode-toggle {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¬ Luma AI Studio</h1>
            <p>Generate stunning 3D videos from your imagination</p>
        </div>

        <div class="mode-toggle">
            <div class="toggle-btn active" id="realModeBtn">ðŸ”‘ Real API Mode</div>
            <div class="toggle-btn" id="demoModeBtn">ðŸŽ­ Demo Mode</div>
        </div>

        <div id="realModeInfo" class="info">
            <strong>ðŸ”‘ Real API Mode:</strong> Uses your actual Luma AI API key. Note: Browser CORS restrictions may apply.
        </div>

        <div id="demoModeInfo" class="info" style="display: none;">
            <strong>ðŸŽ­ Demo Mode:</strong> Simulates the generation process with sample videos to showcase the interface.
        </div>

        <div class="main-content">
            <div class="card">
                <div class="form-group" id="apiKeyGroup">
                    <label for="apiKey">ðŸ”‘ Luma AI API Key:</label>
                    <input type="password" id="apiKey" class="input-field" placeholder="Enter your Luma AI API key..." value="luma-1095db32-5d9a-4066-a2e8-b98fb4291a36-eb985e86-f5ce-4db9-9bd4-6e0b8e6cf75c">
                </div>

                <div class="form-group">
                    <label for="prompt">âœ¨ Describe your 3D scene:</label>
                    <textarea id="prompt" class="input-field prompt-input" placeholder="A majestic dragon soaring through clouds above a medieval castle at sunset...">A steampunk airship flying through cloudy mountains with golden sunset lighting</textarea>
                </div>

                <button id="generateBtn" class="generate-btn">
                    Generate 3D Video âœ¨
                </button>

                <div class="form-group">
                    <label>ðŸŽ¯ Quick Prompts:</label>
                    <div class="preset-grid">
                        <button class="preset-btn" data-prompt="A floating island with waterfalls in a magical sky">Floating Island</button>
                        <button class="preset-btn" data-prompt="A cyberpunk city with neon lights and flying cars">Cyberpunk City</button>
                        <button class="preset-btn" data-prompt="A underwater coral reef with colorful fish swimming">Ocean Reef</button>
                        <button class="preset-btn" data-prompt="A space station orbiting Earth with stars in background">Space Station</button>
                        <button class="preset-btn" data-prompt="A magical forest with glowing mushrooms and fairy lights">Magical Forest</button>
                        <button class="preset-btn" data-prompt="A steampunk airship flying through cloudy mountains">Steampunk Airship</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Creating your 3D masterpiece...</p>
                    <p id="statusText"><small>Initializing generation...</small></p>
                </div>

                <div id="result" class="result">
                    <video id="resultVideo" controls>
                        Your browser does not support the video tag.
                    </video>
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 12px; margin-top: 15px;">
                        <p><strong>Generated Video</strong></p>
                        <p id="promptUsed"></p>
                        <p id="generationInfo"></p>
                    </div>
                </div>

                <div id="error" class="error">
                    <p id="errorMessage"></p>
                </div>

                <div id="placeholder" class="placeholder">
                    <div class="placeholder-icon">ðŸŽ¥</div>
                    <h3>Your 3D video will appear here</h3>
                    <p>Enter your prompt and click generate!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'real';
        let isGenerating = false;

        const demoVideos = [
            'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
            'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
            'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4'
        ];

        function switchMode(mode) {
            currentMode = mode;
            
            document.getElementById('realModeBtn').classList.toggle('active', mode === 'real');
            document.getElementById('demoModeBtn').classList.toggle('active', mode === 'demo');
            
            document.getElementById('realModeInfo').style.display = mode === 'real' ? 'block' : 'none';
            document.getElementById('demoModeInfo').style.display = mode === 'demo' ? 'block' : 'none';
            document.getElementById('apiKeyGroup').style.display = mode === 'real' ? 'block' : 'none';
            
            hideAllStates();
            document.getElementById('placeholder').style.display = 'block';
        }

        function hideAllStates() {
            document.getElementById('loading').classList.remove('active');
            document.getElementById('result').classList.remove('active');
            document.getElementById('error').classList.remove('active');
            document.getElementById('placeholder').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').classList.add('active');
            setTimeout(() => {
                document.getElementById('error').classList.remove('active');
            }, 8000);
        }

        function setPrompt(prompt) {
            document.getElementById('prompt').value = prompt;
        }

        async function generateVideoDemo(prompt) {
            const steps = ['Analyzing prompt...', 'Generating 3D scene...', 'Rendering frames...', 'Compositing video...', 'Finalizing...'];
            
            for (let i = 0; i < steps.length; i++) {
                document.getElementById('statusText').innerHTML = '<small>' + steps[i] + '</small>';
                await new Promise(resolve => setTimeout(resolve, 1500));
            }

            const randomVideo = demoVideos[Math.floor(Math.random() * demoVideos.length)];
            
            hideAllStates();
            document.getElementById('resultVideo').src = randomVideo;
            document.getElementById('promptUsed').textContent = '"' + prompt + '"';
            document.getElementById('generationInfo').innerHTML = '<small>ðŸŽ­ Demo Mode - Sample video for demonstration</small>';
            document.getElementById('result').classList.add('active');
        }

        async function generateVideoReal(apiKey, prompt) {
            try {
                document.getElementById('statusText').innerHTML = '<small>Connecting to Luma AI...</small>';
                
                const response = await fetch('https://api.lumalabs.ai/dream-machine/v1/generations', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        aspect_ratio: '16:9'
                    })
                });

                if (!response.ok) {
                    if (response.status === 0) {
                        throw new Error('CORS_BLOCKED');
                    }
                    throw new Error('API Error: ' + response.status);
                }

                const data = await response.json();
                document.getElementById('statusText').innerHTML = '<small>Generation started, polling for completion...</small>';

                // Poll for completion
                const generationId = data.id;
                let attempts = 0;
                const maxAttempts = 60;

                while (attempts < maxAttempts) {
                    await new Promise(resolve => setTimeout(resolve, 5000));
                    attempts++;
                    
                    document.getElementById('statusText').innerHTML = '<small>Processing... (' + attempts + '/' + maxAttempts + ')</small>';

                    const statusResponse = await fetch('https://api.lumalabs.ai/dream-machine/v1/generations/' + generationId, {
                        headers: {
                            'Authorization': 'Bearer ' + apiKey
                        }
                    });

                    if (statusResponse.ok) {
                        const statusData = await statusResponse.json();
                        
                        if (statusData.state === 'completed') {
                            hideAllStates();
                            document.getElementById('resultVideo').src = statusData.assets.video;
                            document.getElementById('promptUsed').textContent = '"' + prompt + '"';
                            document.getElementById('generationInfo').innerHTML = '<small>âœ… Generated with Luma AI API â€¢ ID: ' + generationId + '</small>';
                            document.getElementById('result').classList.add('active');
                            return;
                        } else if (statusData.state === 'failed') {
                            throw new Error('Generation failed: ' + (statusData.failure_reason || 'Unknown error'));
                        }
                    }
                }

                throw new Error('Generation timed out after 5 minutes');

            } catch (error) {
                if (error.message === 'CORS_BLOCKED' || error.message.includes('Failed to fetch')) {
                    throw new Error('âš ï¸ Browser CORS restriction detected!\n\nThe browser is blocking direct API calls to Luma AI. This is normal for security reasons.\n\nâœ… Try Demo Mode to see how it works, or use this in a proper server environment.');
                }
                throw error;
            }
        }

        async function generateVideo() {
            if (isGenerating) return;

            const prompt = document.getElementById('prompt').value.trim();
            if (!prompt) {
                showError('Please enter a prompt describing your 3D scene');
                return;
            }

            if (currentMode === 'real') {
                const apiKey = document.getElementById('apiKey').value.trim();
                if (!apiKey) {
                    showError('Please enter your Luma AI API key');
                    return;
                }
            }

            isGenerating = true;
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = 'Generating...';
            
            hideAllStates();
            document.getElementById('loading').classList.add('active');

            try {
                if (currentMode === 'demo') {
                    await generateVideoDemo(prompt);
                } else {
                    const apiKey = document.getElementById('apiKey').value.trim();
                    await generateVideoReal(apiKey, prompt);
                }
            } catch (error) {
                hideAllStates();
                showError(error.message);
            } finally {
                isGenerating = false;
                btn.disabled = false;
                btn.textContent = 'Generate 3D Video âœ¨';
            }
        }

        // Event listeners
        document.getElementById('realModeBtn').addEventListener('click', () => switchMode('real'));
        document.getElementById('demoModeBtn').addEventListener('click', () => switchMode('demo'));
        document.getElementById('generateBtn').addEventListener('click', generateVideo);

        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                setPrompt(btn.getAttribute('data-prompt'));
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    btn.style.transform = '';
                }, 150);
            });
        });

        document.getElementById('prompt').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                generateVideo();
            }
        });

        // Initialize
        switchMode('real');
    </script>
</body>
</html>

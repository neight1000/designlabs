<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Luma Full Auto Upload</title>
  <style>
    body { font-family: Arial; padding: 40px; }
    input, button { margin-top: 20px; }
  </style>
</head>
<body>

  <h1>Luma Direct Upload â€” Full Auto Version</h1>

  <input type="file" id="fileInput"><br>
  <button onclick="submitFile()">Submit to Luma</button>

  <p id="status"></p>
  <div id="result"></div>

  <script>
    // YOUR ACTUAL API KEY EMBEDDED:
    const apikey = 'luma-1095db32-5d9a-4066-a2e8-b98fb4291a36-eb985e86-f5ce-4db9-9bd4-6e0b8e6cf75c';

    async function submitFile() {
      const fileInput = document.getElementById("fileInput");
      const status = document.getElementById("status");
      const result = document.getElementById("result");

      if (fileInput.files.length === 0) {
        alert("Select a file.");
        return;
      }

      const file = fileInput.files[0];
      status.innerText = "Requesting upload URL...";

      const presigned = await fetch("https://api.luma.ai/v1/uploads", {
        method: "POST",
        headers: { Authorization: `Bearer ${apikey}` }
      }).then(res => res.json());

      const uploadURL = presigned.url;
      const fileID = presigned.file_id;

      status.innerText = "Uploading file...";

      await fetch(uploadURL, {
        method: "PUT",
        body: file
      });

      status.innerText = "Submitting to Luma for processing...";

      const inference = await fetch("https://api.luma.ai/v1/captures", {
        method: "POST",
        headers: {
          Authorization: `Bearer ${apikey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ file_id: fileID })
      }).then(res => res.json());

      const inferenceID = inference.id;

      let completed = false;
      while (!completed) {
        await new Promise(resolve => setTimeout(resolve, 5000));
        const check = await fetch(`https://api.luma.ai/v1/captures/${inferenceID}`, {
          headers: { Authorization: `Bearer ${apikey}` }
        }).then(res => res.json());

        status.innerText = `Status: ${check.state}`;

        if (check.state === "completed") {
          completed = true;
          result.innerHTML = `<p>Completed!</p><a href="${check.captureUrl}" target="_blank">View Result</a>`;
        }
      }
    }
  </script>

</body>
</html>

